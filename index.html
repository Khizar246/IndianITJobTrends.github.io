<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IT Career Insights Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://unpkg.com/papaparse@5.4.1/papaparse.min.js"></script>
    <!-- Fallback for PapaParse -->
    <script>
        // Check if Papa is loaded, if not load from alternative CDN
        if (typeof Papa === 'undefined') {
            console.log('Loading PapaParse from alternative CDN...');
            const script = document.createElement('script');
            script.src = 'https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js';
            script.onload = function() {
                console.log('PapaParse loaded successfully from fallback CDN');
                if (typeof loadData === 'function') {
                    loadData();
                }
            };
            script.onerror = function() {
                console.error('Failed to load PapaParse from both CDNs');
                document.getElementById('loading').innerHTML = 
                    '<i class="fas fa-exclamation-triangle"></i><h3>Library Loading Error</h3>' +
                    '<p>Unable to load required CSV parsing library. Please check your internet connection.</p>' +
                    '<div style="margin-top: 20px;"><button onclick="location.reload()" class="btn btn-primary">Reload Page</button></div>';
            };
            document.head.appendChild(script);
        }
    </script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: #F8F9FA;
            color: #2D3436;
            line-height: 1.6;
        }

        .dashboard-container {
            display: grid;
            grid-template-columns: 280px 1fr;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            background: white;
            box-shadow: 2px 0 10px rgba(0,0,0,0.05);
            padding: 30px 25px;
            border-right: 1px solid #E5E7EB;
        }

        .logo {
            text-align: center;
            margin-bottom: 40px;
        }

        .logo h1 {
            font-size: 1.4rem;
            font-weight: 700;
            color: #7B61FF;
            margin-bottom: 5px;
        }

        .logo p {
            font-size: 0.85rem;
            color: #6C757D;
        }

        .nav-section {
            margin-bottom: 35px;
        }

        .nav-section h3 {
            font-size: 0.8rem;
            font-weight: 600;
            color: #6C757D;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 15px;
        }

        .nav-item {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-bottom: 5px;
            color: #6C757D;
        }

        .nav-item:hover {
            background: #F3F4F6;
            color: #2D3436;
        }

        .nav-item.active {
            background: #7B61FF;
            color: white;
        }

        .nav-item i {
            width: 20px;
            margin-right: 12px;
        }

        .filters-sidebar {
            background: #F8F9FA;
            padding: 20px;
            border-radius: 12px;
            border: 1px solid #E5E7EB;
        }

        .filter-group {
            margin-bottom: 20px;
        }

        .filter-group label {
            display: block;
            font-size: 0.8rem;
            font-weight: 600;
            color: #6C757D;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        .filter-group select {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #E5E7EB;
            border-radius: 8px;
            background: white;
            font-size: 0.9rem;
            transition: border-color 0.2s ease;
        }

        .filter-group select:focus {
            outline: none;
            border-color: #7B61FF;
        }

        /* Main Content */
        .main-content {
            padding: 30px;
            overflow-y: auto;
        }

        .header {
            margin-bottom: 35px;
        }

        .header h1 {
            font-size: 2rem;
            font-weight: 700;
            color: #2D3436;
            margin-bottom: 8px;
        }

        .header p {
            color: #6C757D;
            font-size: 1rem;
        }

        .data-source {
            background: linear-gradient(135deg, #62C1FF, #7B61FF);
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 0.85rem;
            margin-bottom: 30px;
            display: inline-block;
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 35px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.06);
            border: 1px solid #F1F3F4;
            text-align: center;
        }

        .stat-card .icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            font-size: 1.5rem;
            color: white;
        }

        .stat-card .icon.primary { background: #7B61FF; }
        .stat-card .icon.secondary { background: #62C1FF; }
        .stat-card .icon.success { background: #10B981; }
        .stat-card .icon.warning { background: #F59E0B; }

        .stat-card .value {
            font-size: 1.8rem;
            font-weight: 700;
            color: #2D3436;
            margin-bottom: 5px;
        }

        .stat-card .label {
            font-size: 0.9rem;
            color: #6C757D;
            font-weight: 500;
        }

        /* Tab Content */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Charts Section */
        .charts-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-bottom: 35px;
        }

        .chart-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.06);
            border: 1px solid #F1F3F4;
        }

        .chart-card h3 {
            font-size: 1.2rem;
            font-weight: 600;
            color: #2D3436;
            margin-bottom: 20px;
        }

        .chart-container {
            position: relative;
            height: 400px;
        }

        /* Career Path Section */
        .career-section {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.06);
            border: 1px solid #F1F3F4;
            margin-bottom: 35px;
        }

        .career-section h2 {
            font-size: 1.4rem;
            font-weight: 700;
            color: #2D3436;
            margin-bottom: 20px;
        }

        .career-paths {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
        }

        .career-card {
            background: linear-gradient(135deg, #7B61FF 0%, #62C1FF 100%);
            padding: 25px;
            border-radius: 12px;
            color: white;
            position: relative;
            overflow: hidden;
        }

        .career-card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100px;
            height: 100px;
            background: rgba(255,255,255,0.1);
            border-radius: 50%;
            transform: translate(30px, -30px);
        }

        .career-card h3 {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 15px;
            position: relative;
            z-index: 1;
        }

        .career-info {
            position: relative;
            z-index: 1;
        }

        .career-info .salary {
            font-size: 1.4rem;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .career-info .skills {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-bottom: 15px;
        }

        .career-buttons {
            display: flex;
            gap: 10px;
            position: relative;
            z-index: 1;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            font-size: 0.85rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-primary {
            background: white;
            color: #7B61FF;
        }

        .btn-secondary {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
        }

        .btn:hover {
            transform: translateY(-1px);
        }

        /* Skills Overview - 5 equal columns */
        .skills-overview {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 20px;
        }

        .skill-category {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.06);
            border: 1px solid #F1F3F4;
        }

        .skill-category h4 {
            font-size: 1rem;
            font-weight: 600;
            color: #2D3436;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }

        .skill-category h4 i {
            margin-right: 8px;
            color: #7B61FF;
        }

        .skill-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #F1F3F4;
        }

        .skill-item:last-child {
            border-bottom: none;
        }

        .skill-name {
            font-weight: 500;
            color: #2D3436;
        }

        .skill-stats {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .skill-count {
            background: #7B61FF;
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        /* Motivational Banner */
        .motivation-banner {
            background: linear-gradient(135deg, #10B981, #059669);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 25px;
            text-align: center;
        }

        .motivation-banner h3 {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .motivation-banner p {
            opacity: 0.9;
            font-size: 0.9rem;
        }

        /* Loading State */
        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 60vh;
            color: #6C757D;
        }

        .loading i {
            font-size: 2rem;
            margin-bottom: 15px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .dashboard-container {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                display: none;
            }
            
            .charts-section {
                grid-template-columns: 1fr;
            }
            
            .career-paths {
                grid-template-columns: 1fr;
            }
            
            .skills-overview {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 1200px) {
            .skills-overview {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (max-width: 900px) {
            .skills-overview {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="logo">
                <h1><i class="fas fa-chart-line"></i> Career Insights</h1>
                <p>Your path to success</p>
            </div>

            <div class="nav-section">
                <h3>Analysis</h3>
                <div class="nav-item active" onclick="showTab('skills')">
                    <i class="fas fa-code"></i>
                    <span>Skills Overview</span>
                </div>
                <div class="nav-item" onclick="showTab('salary')">
                    <i class="fas fa-rupee-sign"></i>
                    <span>Salary Insights</span>
                </div>
                <div class="nav-item" onclick="showTab('career')">
                    <i class="fas fa-route"></i>
                    <span>Career Paths</span>
                </div>
            </div>

            <div class="nav-section">
                <h3>Filters</h3>
                <div class="filters-sidebar">
                    <div class="filter-group" id="skillsFilters">
                        <label for="jobTitle">Job Title</label>
                        <select id="jobTitle">
                            <option value="All">All Positions</option>
                        </select>
                    </div>
                    <div class="filter-group" id="skillsFilters2">
                        <label for="category">Skill Category</label>
                        <select id="category">
                            <option value="All">All Categories</option>
                        </select>
                    </div>
                    <div class="filter-group" id="salaryFilters" style="display:none;">
                        <label for="location">Location</label>
                        <select id="location">
                            <option value="All">All Locations</option>
                        </select>
                    </div>
                    <div class="filter-group" id="salaryFilters2" style="display:none;">
                        <label for="experience">Experience</label>
                        <select id="experience">
                            <option value="All">All Levels</option>
                        </select>
                    </div>
                    <div class="filter-group" id="salaryFilters3" style="display:none;">
                        <label for="jobRole">Job Title</label>
                        <select id="jobRole">
                            <option value="All">All Job Roles</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="nav-section">
                <h3>Quick Stats</h3>
                <div style="font-size: 0.85rem; color: #6C757D; line-height: 1.5;">
                    <div style="margin-bottom: 8px;">
                        <strong id="quickJobCount">0</strong> jobs analyzed
                    </div>
                    <div style="margin-bottom: 8px;">
                        <strong id="quickCompanyCount">0</strong> companies
                    </div>
                    <div>
                        Avg: <strong id="quickAvgSalary">₹0L</strong>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <div class="loading" id="loading">
                <i class="fas fa-spinner"></i>
                <h3>Loading Your Career Insights...</h3>
                <p>Analyzing job market data for personalized recommendations</p>
            </div>

            <div id="dashboard" style="display: none;">
                <div class="header">
                    <h1>IT Career Analytics Dashboard</h1>
                    <p>Discover opportunities, understand market trends, and plan your career path</p>
                </div>

                <div class="data-source">
                    <i class="fas fa-database"></i> Source: Career Data Analysis (34,646+ job records)
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="icon primary"><i class="fas fa-briefcase"></i></div>
                        <div class="value" id="totalJobs">0</div>
                        <div class="label">Available Positions</div>
                    </div>
                    <div class="stat-card">
                        <div class="icon secondary"><i class="fas fa-building"></i></div>
                        <div class="value" id="totalCompanies">0</div>
                        <div class="label">Hiring Companies</div>
                    </div>
                    <div class="stat-card">
                        <div class="icon success"><i class="fas fa-chart-line"></i></div>
                        <div class="value" id="avgSalary">₹0L</div>
                        <div class="label">Average Salary</div>
                    </div>
                    <div class="stat-card">
                        <div class="icon warning"><i class="fas fa-code"></i></div>
                        <div class="value" id="uniqueSkills">0</div>
                        <div class="label">Skills in Demand</div>
                    </div>
                </div>

                <!-- Skills Overview Tab -->
                <div id="skillsTab" class="tab-content active">
                    <div class="motivation-banner">
                        <h3><i class="fas fa-rocket"></i> Level Up Your Skills!</h3>
                        <p>Focus on high-demand skills to boost your career prospects and earning potential</p>
                    </div>

                    <div class="charts-section">
                        <div class="chart-card">
                            <h3><i class="fas fa-trophy"></i> Most In-Demand Skills</h3>
                            <div class="chart-container">
                                <canvas id="skillsChart"></canvas>
                            </div>
                        </div>
                        <div class="chart-card">
                            <h3><i class="fas fa-layer-group"></i> Skills Distribution</h3>
                            <div class="chart-container">
                                <canvas id="categoryChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <div class="skills-overview">
                        <div class="skill-category">
                            <h4><i class="fas fa-cloud"></i> Cloud Technologies</h4>
                            <div id="cloudSkillsList"></div>
                        </div>
                        <div class="skill-category">
                            <h4><i class="fas fa-database"></i> Database Skills</h4>
                            <div id="databaseSkillsList"></div>
                        </div>
                        <div class="skill-category">
                            <h4><i class="fas fa-layer-group"></i> Frameworks</h4>
                            <div id="frameworksSkillsList"></div>
                        </div>
                        <div class="skill-category">
                            <h4><i class="fas fa-code"></i> Languages</h4>
                            <div id="languagesSkillsList"></div>
                        </div>
                        <div class="skill-category">
                            <h4><i class="fas fa-cog"></i> Tools</h4>
                            <div id="toolsSkillsList"></div>
                        </div>
                    </div>
                </div>

                <!-- Salary Insights Tab -->
                <div id="salaryTab" class="tab-content">
                    <div class="motivation-banner">
                        <h3><i class="fas fa-chart-bar"></i> Salary Intelligence</h3>
                        <p>Make informed decisions about your career moves and salary negotiations</p>
                    </div>

                    <div class="charts-section">
                        <div class="chart-card">
                            <h3><i class="fas fa-graduation-cap"></i> Salary Growth by Experience</h3>
                            <div class="chart-container">
                                <canvas id="salaryExpChart"></canvas>
                            </div>
                        </div>
                        <div class="chart-card">
                            <h3><i class="fas fa-user-tie"></i> Salary by Job Role</h3>
                            <div class="chart-container">
                                <canvas id="salaryRoleChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <div class="charts-section" style="grid-template-columns: 1fr;">
                        <div class="chart-card">
                            <h3><i class="fas fa-chart-area"></i> Salary Distribution by City</h3>
                            <div class="chart-container" style="height: 500px;">
                                <canvas id="salaryLocationChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <div style="background: #F8F9FA; border: 1px solid #E5E7EB; border-radius: 8px; padding: 15px; margin-top: 20px; text-align: center;">
                        <p style="font-size: 0.85rem; color: #6C757D; margin: 0; line-height: 1.5;">
                            <i class="fas fa-info-circle" style="color: #7B61FF; margin-right: 5px;"></i>
                            <strong>Note:</strong> The provided salary figures serve as a general reference. Actual salaries can vary based on experience, location, skills, company, and other factors. Treat this as a starting point and conduct further research to assess compensation packages comprehensively.
                        </p>
                    </div>
                </div>

                <!-- Career Paths Tab -->
                <div id="careerTab" class="tab-content">
                    <div class="career-section">
                        <h2><i class="fas fa-compass"></i> Recommended Career Paths</h2>
                        <p style="color: #6C757D; margin-bottom: 25px;">Based on current market demand and salary potential</p>
                        
                        <div class="career-paths" id="careerPaths">
                            <!-- Career paths will be populated dynamically -->
                        </div>
                    </div>

                    <div class="motivation-banner">
                        <h3><i class="fas fa-lightbulb"></i> Pro Tip</h3>
                        <p>Combine multiple high-demand skills to maximize your market value and career opportunities</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let allData = [];
        let filteredData = [];
        let charts = {};
        let currentTab = 'skills';

        // Load and parse CSV data
        async function loadData() {
            try {
                // Check if Papa is available
                if (typeof Papa === 'undefined') {
                    throw new Error('Papa is not defined - CSV parsing library not loaded');
                }
                
                console.log('Loading CSV file...');
                
                // Fetch the CSV file from the same directory
                const response = await fetch('./Final_Data.csv');
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const csvContent = await response.text();
                console.log('CSV file loaded successfully, size:', csvContent.length, 'characters');
                console.log('First 200 characters:', csvContent.substring(0, 200));
                
                // Parse CSV with Papa Parse
                const result = Papa.parse(csvContent, {
                    header: true,
                    dynamicTyping: true,
                    skipEmptyLines: true,
                    delimiter: ',', // Explicitly set delimiter
                    quoteChar: '"',
                    escapeChar: '"'
                });
                
                console.log('Papa Parse result:', {
                    data: result.data.length + ' rows',
                    errors: result.errors.length + ' errors',
                    meta: result.meta
                });
                
                if (result.errors.length > 0) {
                    console.warn('Parse errors:', result.errors);
                }
                
                if (result.data && result.data.length > 0) {
                    console.log('Sample parsed row:', result.data[0]);
                    
                    // Clean data - remove rows with missing critical data
                    allData = result.data.filter(row => 
                        row && 
                        row.COMPANY && 
                        row.SALARY && 
                        row.TITLE && 
                        row.LOCATION && 
                        row.SKILLS &&
                        typeof row.COMPANY === 'string' && row.COMPANY.trim() !== '' &&
                        typeof row.TITLE === 'string' && row.TITLE.trim() !== '' &&
                        typeof row.LOCATION === 'string' && row.LOCATION.trim() !== '' &&
                        typeof row.SKILLS === 'string' && row.SKILLS.trim() !== '' &&
                        (typeof row.SALARY === 'number' && row.SALARY > 0)
                    );
                    console.log('Filtered valid records:', allData.length);
                } else {
                    throw new Error('No valid data found in CSV');
                }
                
                if (allData.length === 0) {
                    throw new Error('No valid records after filtering');
                }
                
                filteredData = [...allData];
                
                populateFilters();
                updateDashboard();
                
                document.getElementById('loading').style.display = 'none';
                document.getElementById('dashboard').style.display = 'block';
                
                console.log('Dashboard loaded successfully with', allData.length, 'records');
                
            } catch (error) {
                console.error('Error loading data:', error);
                
                // Provide more specific error messages
                let errorMessage = '<i class="fas fa-exclamation-triangle"></i><h3>Unable to load data</h3>';
                
                if (error.message.includes('Papa is not defined')) {
                    errorMessage += '<p>CSV parsing library failed to load. Please check your internet connection and try again.</p>';
                } else if (error.message.includes('HTTP error')) {
                    errorMessage += '<p>CSV file not found. Please ensure "Final_Data.csv" is in the same folder as this HTML file.</p>';
                    errorMessage += '<p style="font-size: 0.9rem; color: #6C757D;">Expected location: ./Final_Data.csv</p>';
                } else if (error.message.includes('Failed to fetch')) {
                    errorMessage += '<p>Unable to load CSV file. This might be due to browser security restrictions.</p>';
                    errorMessage += '<p style="font-size: 0.9rem; color: #6C757D;">Try running this from a local server or hosting environment.</p>';
                } else {
                    errorMessage += '<p>Error parsing CSV data: ' + error.message + '</p>';
                }
                
                errorMessage += '<div style="margin-top: 20px;"><button onclick="loadData()" class="btn btn-primary">Retry Loading</button></div>';
                
                document.getElementById('loading').innerHTML = errorMessage;
            }
        }

        // Populate filter dropdowns
        function populateFilters() {
            const jobTitles = [...new Set(allData.map(d => d.TITLE))].sort();
            const categories = [...new Set(allData.map(d => d.CATEGORY))].sort();
            const locations = [...new Set(allData.map(d => d.LOCATION))].sort();
            const experiences = [...new Set(allData.map(d => d.EXPERIENCE))].sort();

            populateSelect('jobTitle', jobTitles);
            populateSelect('category', categories);
            populateSelect('location', locations);
            populateSelect('experience', experiences);
            populateSelect('jobRole', jobTitles); // Same as job titles for role filter
        }

        function populateSelect(selectId, options) {
            const select = document.getElementById(selectId);
            // Clear existing options except the first one
            while (select.children.length > 1) {
                select.removeChild(select.lastChild);
            }
            
            options.forEach(option => {
                const optionElement = document.createElement('option');
                optionElement.value = option;
                optionElement.textContent = option;
                select.appendChild(optionElement);
            });
        }

        // Filter data based on selections
        function filterData() {
            const jobTitle = document.getElementById('jobTitle').value;
            const category = document.getElementById('category').value;
            const location = document.getElementById('location').value;
            const experience = document.getElementById('experience').value;
            const jobRole = document.getElementById('jobRole') ? document.getElementById('jobRole').value : 'All';

            filteredData = allData.filter(row => {
                return (jobTitle === 'All' || row.TITLE === jobTitle) &&
                       (category === 'All' || row.CATEGORY === category) &&
                       (location === 'All' || row.LOCATION === location) &&
                       (experience === 'All' || row.EXPERIENCE === experience) &&
                       (jobRole === 'All' || row.TITLE === jobRole);
            });

            updateDashboard();
        }

        // Update dashboard statistics and charts
        function updateDashboard() {
            updateStats();
            updateQuickStats();
            if (currentTab === 'skills') {
                updateSkillsCharts();
            } else if (currentTab === 'salary') {
                updateSalaryCharts();
            } else if (currentTab === 'career') {
                updateCareerPaths();
            }
        }

        function updateStats() {
            const totalJobs = filteredData.length;
            const totalCompanies = new Set(filteredData.map(d => d.COMPANY)).size;
            const avgSalary = Math.round(filteredData.reduce((sum, d) => sum + d.SALARY, 0) / totalJobs);
            
            // Get unique skills
            const allSkills = [];
            filteredData.forEach(d => {
                if (d.SKILLS) {
                    allSkills.push(...d.SKILLS.split(',').map(s => s.trim()));
                }
            });
            const uniqueSkills = new Set(allSkills).size;

            document.getElementById('totalJobs').textContent = totalJobs.toLocaleString();
            document.getElementById('totalCompanies').textContent = totalCompanies.toLocaleString();
            document.getElementById('avgSalary').textContent = `₹${(avgSalary/100000).toFixed(1)}L`;
            document.getElementById('uniqueSkills').textContent = uniqueSkills.toLocaleString();
        }

        function updateQuickStats() {
            const totalJobs = filteredData.length;
            const totalCompanies = new Set(filteredData.map(d => d.COMPANY)).size;
            const avgSalary = Math.round(filteredData.reduce((sum, d) => sum + d.SALARY, 0) / totalJobs);

            document.getElementById('quickJobCount').textContent = totalJobs.toLocaleString();
            document.getElementById('quickCompanyCount').textContent = totalCompanies.toLocaleString();
            document.getElementById('quickAvgSalary').textContent = `₹${(avgSalary/100000).toFixed(1)}L`;
        }

        function updateSkillsCharts() {
            // Properly destroy existing charts first
            if (charts.skillsChart) {
                charts.skillsChart.destroy();
                delete charts.skillsChart;
            }
            if (charts.categoryChart) {
                charts.categoryChart.destroy();
                delete charts.categoryChart;
            }
            
            // Get skills data
            const skillCounts = {};
            const skillSalaries = {};
            const skillCategories = {};
            
            filteredData.forEach(d => {
                if (d.SKILLS) {
                    d.SKILLS.split(',').map(s => s.trim()).forEach(skill => {
                        if (!skillCounts[skill]) {
                            skillCounts[skill] = 0;
                            skillSalaries[skill] = [];
                            skillCategories[skill] = d.CATEGORY;
                        }
                        skillCounts[skill]++;
                        skillSalaries[skill].push(d.SALARY);
                    });
                }
            });

            // Calculate average salaries for skills
            Object.keys(skillSalaries).forEach(skill => {
                const salaries = skillSalaries[skill];
                skillSalaries[skill] = Math.round(salaries.reduce((sum, s) => sum + s, 0) / salaries.length);
            });

            // Top skills chart
            const topSkills = Object.entries(skillCounts)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 12);

            charts.skillsChart = new Chart(document.getElementById('skillsChart').getContext('2d'), {
                type: 'bar',
                data: {
                    labels: topSkills.map(([skill, count]) => skill),
                    datasets: [{
                        label: 'Job Openings',
                        data: topSkills.map(([skill, count]) => count),
                        backgroundColor: '#7B61FF',
                        borderRadius: 6,
                        borderSkipped: false,
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    layout: {
                        padding: {
                            bottom: 40
                        }
                    },
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            grid: { display: false },
                            ticks: { color: '#6C757D' }
                        },
                        y: {
                            grid: { display: false },
                            ticks: { color: '#6C757D', font: { size: 11 } }
                        }
                    }
                }
            });

            // Category distribution chart
            const categoryCounts = {};
            filteredData.forEach(d => {
                categoryCounts[d.CATEGORY] = (categoryCounts[d.CATEGORY] || 0) + 1;
            });

            charts.categoryChart = new Chart(document.getElementById('categoryChart').getContext('2d'), {
                type: 'doughnut',
                data: {
                    labels: Object.keys(categoryCounts),
                    datasets: [{
                        data: Object.values(categoryCounts),
                        backgroundColor: [
                            '#7B61FF', '#62C1FF', '#10B981', '#F59E0B', '#EF4444'
                        ],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: { 
                                color: '#6C757D', 
                                padding: 15,
                                font: { size: 11 }
                            }
                        }
                    }
                }
            });

            // Update skill lists
            updateSkillLists(skillCounts, skillSalaries, skillCategories);
        }

        function updateSkillLists(skillCounts, skillSalaries, skillCategories) {
            // Skills by category - all 5 categories
            const cloudSkills = Object.entries(skillCounts)
                .filter(([skill, count]) => skillCategories[skill] === 'Cloud')
                .sort((a, b) => b[1] - a[1])
                .slice(0, 6);

            const dbSkills = Object.entries(skillCounts)
                .filter(([skill, count]) => skillCategories[skill] === 'Databases')
                .sort((a, b) => b[1] - a[1])
                .slice(0, 6);

            const frameworkSkills = Object.entries(skillCounts)
                .filter(([skill, count]) => skillCategories[skill] === 'Frameworks')
                .sort((a, b) => b[1] - a[1])
                .slice(0, 6);

            const languageSkills = Object.entries(skillCounts)
                .filter(([skill, count]) => skillCategories[skill] === 'Languages')
                .sort((a, b) => b[1] - a[1])
                .slice(0, 6);

            const toolSkills = Object.entries(skillCounts)
                .filter(([skill, count]) => skillCategories[skill] === 'Tools')
                .sort((a, b) => b[1] - a[1])
                .slice(0, 6);

            // Update HTML - removed salary display
            document.getElementById('cloudSkillsList').innerHTML = 
                cloudSkills.map(([skill, count]) => 
                    `<div class="skill-item">
                        <span class="skill-name">${skill}</span>
                        <div class="skill-stats">
                            <span class="skill-count">${count}</span>
                        </div>
                    </div>`
                ).join('');

            document.getElementById('databaseSkillsList').innerHTML = 
                dbSkills.map(([skill, count]) => 
                    `<div class="skill-item">
                        <span class="skill-name">${skill}</span>
                        <div class="skill-stats">
                            <span class="skill-count">${count}</span>
                        </div>
                    </div>`
                ).join('');

            document.getElementById('frameworksSkillsList').innerHTML = 
                frameworkSkills.map(([skill, count]) => 
                    `<div class="skill-item">
                        <span class="skill-name">${skill}</span>
                        <div class="skill-stats">
                            <span class="skill-count">${count}</span>
                        </div>
                    </div>`
                ).join('');

            document.getElementById('languagesSkillsList').innerHTML = 
                languageSkills.map(([skill, count]) => 
                    `<div class="skill-item">
                        <span class="skill-name">${skill}</span>
                        <div class="skill-stats">
                            <span class="skill-count">${count}</span>
                        </div>
                    </div>`
                ).join('');

            document.getElementById('toolsSkillsList').innerHTML = 
                toolSkills.map(([skill, count]) => 
                    `<div class="skill-item">
                        <span class="skill-name">${skill}</span>
                        <div class="skill-stats">
                            <span class="skill-count">${count}</span>
                        </div>
                    </div>`
                ).join('');
        }

        function updateSalaryCharts() {
            // Properly destroy existing charts first
            if (charts.salaryExpChart) {
                charts.salaryExpChart.destroy();
                delete charts.salaryExpChart;
            }
            if (charts.salaryLocationChart) {
                charts.salaryLocationChart.destroy();
                delete charts.salaryLocationChart;
            }
            if (charts.salaryRoleChart) {
                charts.salaryRoleChart.destroy();
                delete charts.salaryRoleChart;
            }

            // Salary by experience - PROPER LINE CHART
            const expSalaries = {};
            const expCounts = {};
            
            filteredData.forEach(d => {
                if (!expSalaries[d.EXPERIENCE]) {
                    expSalaries[d.EXPERIENCE] = 0;
                    expCounts[d.EXPERIENCE] = 0;
                }
                expSalaries[d.EXPERIENCE] += d.SALARY;
                expCounts[d.EXPERIENCE]++;
            });

            const expOrder = ['0 - 3 yrs', '4 - 7 yrs', '8 - 10 yrs', '10+ yrs'];
            const expData = expOrder
                .filter(exp => expSalaries[exp])
                .map(exp => [exp, Math.round(expSalaries[exp] / expCounts[exp])]);

            // Create clean line chart without any interference
            charts.salaryExpChart = new Chart(document.getElementById('salaryExpChart').getContext('2d'), {
                type: 'line',
                data: {
                    labels: expData.map(([exp, salary]) => exp),
                    datasets: [{
                        label: 'Average Salary',
                        data: expData.map(([exp, salary]) => salary / 100000),
                        borderColor: '#7B61FF',
                        backgroundColor: 'rgba(123, 97, 255, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: '#7B61FF',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        x: {
                            grid: { display: false },
                            ticks: { color: '#6C757D' }
                        },
                        y: {
                            grid: { color: 'rgba(0,0,0,0.05)' },
                            ticks: { 
                                color: '#6C757D',
                                callback: function(value) {
                                    return '₹' + value + 'L';
                                }
                            }
                        }
                    }
                }
            });

            // Salary by job role - horizontal bar chart
            const titleSalaries = {};
            const titleCounts = {};
            
            filteredData.forEach(d => {
                if (!titleSalaries[d.TITLE]) {
                    titleSalaries[d.TITLE] = 0;
                    titleCounts[d.TITLE] = 0;
                }
                titleSalaries[d.TITLE] += d.SALARY;
                titleCounts[d.TITLE]++;
            });

            const titleData = Object.entries(titleSalaries)
                .map(([title, totalSalary]) => [title, Math.round(totalSalary / titleCounts[title])])
                .sort((a, b) => b[1] - a[1]);

            charts.salaryRoleChart = new Chart(document.getElementById('salaryRoleChart').getContext('2d'), {
                type: 'bar',
                data: {
                    labels: titleData.map(([title, salary]) => title),
                    datasets: [{
                        label: 'Average Salary',
                        data: titleData.map(([title, salary]) => salary / 100000),
                        backgroundColor: '#10B981',
                        borderRadius: 6,
                        borderSkipped: false,
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            grid: { display: false },
                            ticks: { 
                                color: '#6C757D',
                                callback: function(value) {
                                    return '₹' + value + 'L';
                                }
                            }
                        },
                        y: {
                            grid: { display: false },
                            ticks: { color: '#6C757D', font: { size: 11 } }
                        }
                    }
                }
            });

            // Salary distribution by location - ALL cities in dataset
            const locationSalaries = {};
            
            filteredData.forEach(d => {
                if (!locationSalaries[d.LOCATION]) {
                    locationSalaries[d.LOCATION] = [];
                }
                locationSalaries[d.LOCATION].push(d.SALARY);
            });

            // Get all cities with sufficient data (no artificial limit)
            const locationBoxData = Object.entries(locationSalaries)
                .filter(([location, salaries]) => salaries.length >= 50)
                .map(([location, salaries]) => {
                    const sorted = [...salaries].sort((a, b) => a - b);
                    const q1Index = Math.floor(sorted.length * 0.25);
                    const q3Index = Math.floor(sorted.length * 0.75);
                    const medianIndex = Math.floor(sorted.length * 0.5);
                    
                    return {
                        location,
                        min: sorted[0],
                        q1: sorted[q1Index],
                        median: sorted[medianIndex],
                        q3: sorted[q3Index],
                        max: sorted[sorted.length - 1],
                        count: salaries.length,
                        salaries: sorted
                    };
                })
                .sort((a, b) => b.count - a.count); // Sort by job count

            // Create the city chart with proper box plot
            const ctx = document.getElementById('salaryLocationChart').getContext('2d');
            
            charts.salaryLocationChart = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'Salary Distribution',
                        data: locationBoxData.flatMap((city, cityIndex) => {
                            return city.salaries
                                .filter((_, i) => i % Math.max(1, Math.floor(city.salaries.length / 20)) === 0)
                                .map(salary => ({
                                    x: city.location,
                                    y: salary / 100000,
                                    location: city.location,
                                    salary: salary,
                                    totalJobs: city.count
                                }));
                        }),
                        backgroundColor: 'rgba(123, 97, 255, 0.5)',
                        borderColor: 'rgba(123, 97, 255, 0.7)',
                        borderWidth: 1,
                        pointRadius: 2.5,
                        showLine: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    layout: {
                        padding: {
                            left: 30,
                            right: 30,
                            top: 20,
                            bottom: 60
                        }
                    },
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: 'rgba(45, 52, 54, 0.95)',
                            titleColor: '#ffffff',
                            bodyColor: '#ddd',
                            borderColor: '#74b9ff',
                            borderWidth: 2,
                            cornerRadius: 8,
                            displayColors: false,
                            titleFont: { size: 14, weight: 'bold' },
                            bodyFont: { size: 12 },
                            padding: 12,
                            callbacks: {
                                title: function(context) {
                                    return `📍 ${context[0].raw.location}`;
                                },
                                label: function(context) {
                                    const point = context.raw;
                                    return [
                                        `💰 Salary: ₹${(point.salary/100000).toFixed(1)}L`,
                                        `🏢 Total Jobs: ${point.totalJobs.toLocaleString()}`,
                                        `📊 This represents one salary data point`
                                    ];
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            type: 'category',
                            labels: locationBoxData.map(city => city.location),
                            offset: true,
                            ticks: {
                                color: '#2D3436',
                                font: { size: 11, weight: 500 },
                                maxRotation: 75,
                                minRotation: 75
                            },
                            grid: { 
                                display: false 
                            },
                            title: {
                                display: true,
                                text: 'Cities',
                                color: '#6C757D',
                                font: { size: 12, weight: 600 }
                            }
                        },
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Salary (₹ Lakhs)',
                                color: '#6C757D',
                                font: { size: 12, weight: 600 }
                            },
                            ticks: {
                                color: '#6C757D',
                                font: { size: 11 },
                                callback: function(value) {
                                    return '₹' + value + 'L';
                                }
                            },
                            grid: { 
                                color: 'rgba(0,0,0,0.05)',
                                lineWidth: 1
                            }
                        }
                    }
                },
                plugins: [{
                    id: 'cityBoxPlot',
                    afterDatasetsDraw: function(chart) {
                        if (chart.canvas.id !== 'salaryLocationChart') return;
                        
                        const ctx = chart.ctx;
                        const xScale = chart.scales.x;
                        const yScale = chart.scales.y;
                        
                        locationBoxData.forEach((city, index) => {
                            const xPos = xScale.getPixelForValue(city.location);
                            
                            const yQ1 = yScale.getPixelForValue(city.q1 / 100000);
                            const yQ3 = yScale.getPixelForValue(city.q3 / 100000);
                            const yMedian = yScale.getPixelForValue(city.median / 100000);
                            const yMin = yScale.getPixelForValue(city.min / 100000);
                            const yMax = yScale.getPixelForValue(city.max / 100000);
                            
                            const boxWidth = Math.min(35, Math.max(15, xScale.width / locationBoxData.length * 0.5));
                            const capWidth = boxWidth * 0.5;
                            
                            // Draw whiskers
                            ctx.strokeStyle = '#62C1FF';
                            ctx.lineWidth = 2;
                            ctx.beginPath();
                            ctx.moveTo(xPos, yMin);
                            ctx.lineTo(xPos, yQ1);
                            ctx.moveTo(xPos, yQ3);
                            ctx.lineTo(xPos, yMax);
                            ctx.stroke();
                            
                            // Draw box
                            ctx.fillStyle = 'rgba(98, 193, 255, 0.3)';
                            ctx.strokeStyle = '#62C1FF';
                            ctx.lineWidth = 2;
                            ctx.fillRect(xPos - boxWidth/2, yQ3, boxWidth, yQ1 - yQ3);
                            ctx.strokeRect(xPos - boxWidth/2, yQ3, boxWidth, yQ1 - yQ3);
                            
                            // Draw median line
                            ctx.strokeStyle = '#7B61FF';
                            ctx.lineWidth = 3;
                            ctx.beginPath();
                            ctx.moveTo(xPos - boxWidth/2, yMedian);
                            ctx.lineTo(xPos + boxWidth/2, yMedian);
                            ctx.stroke();
                            
                            // Draw caps
                            ctx.strokeStyle = '#62C1FF';
                            ctx.lineWidth = 2;
                            ctx.beginPath();
                            ctx.moveTo(xPos - capWidth, yMin);
                            ctx.lineTo(xPos + capWidth, yMin);
                            ctx.moveTo(xPos - capWidth, yMax);
                            ctx.lineTo(xPos + capWidth, yMax);
                            ctx.stroke();
                        });
                    }
                }]
            });
        }

        function updateRoleInsights() {
            // Role insights removed as requested
        }

        function updateCareerPaths() {
            // Analyze data to create career path recommendations
            const skillAnalysis = {};
            const titleAnalysis = {};
            
            filteredData.forEach(d => {
                // Analyze skills
                if (d.SKILLS) {
                    d.SKILLS.split(',').map(s => s.trim()).forEach(skill => {
                        if (!skillAnalysis[skill]) {
                            skillAnalysis[skill] = {
                                count: 0,
                                salaries: [],
                                titles: new Set(),
                                category: d.CATEGORY
                            };
                        }
                        skillAnalysis[skill].count++;
                        skillAnalysis[skill].salaries.push(d.SALARY);
                        skillAnalysis[skill].titles.add(d.TITLE);
                    });
                }
                
                // Analyze titles
                if (!titleAnalysis[d.TITLE]) {
                    titleAnalysis[d.TITLE] = {
                        count: 0,
                        salaries: [],
                        skills: new Set(),
                        experiences: new Set()
                    };
                }
                titleAnalysis[d.TITLE].count++;
                titleAnalysis[d.TITLE].salaries.push(d.SALARY);
                if (d.SKILLS) {
                    d.SKILLS.split(',').map(s => s.trim()).forEach(skill => {
                        titleAnalysis[d.TITLE].skills.add(skill);
                    });
                }
                titleAnalysis[d.TITLE].experiences.add(d.EXPERIENCE);
            });

            // Career roadmap URLs
            const roadmapUrls = {
                'Data Scientist': 'https://www.youtube.com/watch?v=yBcfzZJ-gS8',
                'Data Engineer': 'https://www.youtube.com/watch?v=odZHmYgebbw',
                'Software Engineer': 'https://www.youtube.com/watch?v=p2j6Wq57MEE',
                'Web Developer': 'https://www.youtube.com/watch?v=4WjtQjPQGIs',
                'Data Analyst': 'https://www.youtube.com/watch?v=qkm5NwKVzDk',
                'Cloud Engineer': 'https://www.youtube.com/watch?v=VjGVL3P1zqY'
            };

            // Calculate averages and create career paths
            const careerPaths = [];
            
            // Top job titles by demand and salary - replace Consultant with Cloud Engineer
            const topTitles = Object.entries(titleAnalysis)
                .map(([title, data]) => ({
                    title: title === 'Consultant' ? 'Cloud Engineer' : title,
                    count: data.count,
                    avgSalary: Math.round(data.salaries.reduce((sum, s) => sum + s, 0) / data.salaries.length),
                    skills: Array.from(data.skills).slice(0, 4),
                    experiences: Array.from(data.experiences)
                }))
                .filter(path => roadmapUrls[path.title]) // Only include roles with roadmaps
                .sort((a, b) => b.count - a.count)
                .slice(0, 6);

            topTitles.forEach(path => {
                const icon = getCareerIcon(path.title);
                careerPaths.push({
                    title: `🎯 Become a ${path.title}`,
                    salary: `₹${(path.avgSalary/100000).toFixed(1)}L avg`,
                    skills: path.skills.join(', '),
                    demand: `${path.count} openings`,
                    icon: icon,
                    roadmapUrl: roadmapUrls[path.title]
                });
            });

            // Render career paths
            document.getElementById('careerPaths').innerHTML = careerPaths.map(path => 
                `<div class="career-card">
                    <h3>${path.title}</h3>
                    <div class="career-info">
                        <div class="salary">${path.salary}</div>
                        <div class="skills">Key Skills: ${path.skills}</div>
                        <div style="font-size: 0.85rem; opacity: 0.8; margin-bottom: 15px;">${path.demand}</div>
                        <div class="career-buttons">
                            <button class="btn btn-primary" onclick="openRoadmap('${path.roadmapUrl}')">
                                <i class="fas fa-route"></i> Roadmap
                            </button>
                        </div>
                    </div>
                </div>`
            ).join('');
        }

        function openRoadmap(url) {
            window.open(url, '_blank');
        }

        function getCareerIcon(title) {
            const iconMap = {
                'Software Engineer': '💻',
                'Data Scientist': '📊',
                'DevOps Engineer': '⚙️',
                'Data Analyst': '📈',
                'Cloud Engineer': '☁️',
                'Web Developer': '🌐',
                'Data Engineer': '🔧',
                'Cybersecurity': '🔒',
                'Blockchain Engineer': '⛓️'
            };
            return iconMap[title] || '💼';
        }

        // Tab switching functionality - FIXED VERSION
        function showTab(tabName) {
            // Update current tab
            currentTab = tabName;
            
            // Completely destroy all charts first to prevent interference
            Object.keys(charts).forEach(chartKey => {
                if (charts[chartKey] && typeof charts[chartKey].destroy === 'function') {
                    try {
                        charts[chartKey].destroy();
                        delete charts[chartKey];
                    } catch (e) {
                        console.warn('Error destroying chart:', chartKey, e);
                    }
                }
            });
            
            // Clear charts object
            charts = {};
            
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Remove active class from all nav items
            document.querySelectorAll('.nav-item').forEach(nav => {
                nav.classList.remove('active');
            });
            
            // Show selected tab content
            const targetTab = document.getElementById(tabName + 'Tab');
            if (targetTab) {
                targetTab.classList.add('active');
            }
            
            // Add active class to clicked nav item
            const navItem = document.querySelector(`[onclick="showTab('${tabName}')"]`);
            if (navItem) {
                navItem.classList.add('active');
            }
            
            // Show/hide relevant filters
            const skillsFilters = document.querySelectorAll('#skillsFilters, #skillsFilters2');
            const salaryFilters = document.querySelectorAll('#salaryFilters, #salaryFilters2, #salaryFilters3');
            
            if (tabName === 'skills' || tabName === 'career') {
                skillsFilters.forEach(filter => filter.style.display = 'block');
                salaryFilters.forEach(filter => filter.style.display = 'none');
            } else if (tabName === 'salary') {
                skillsFilters.forEach(filter => filter.style.display = 'none');
                salaryFilters.forEach(filter => filter.style.display = 'block');
            }
            
            // Wait for DOM to be ready and then create charts
            setTimeout(() => {
                try {
                    if (tabName === 'skills') {
                        updateSkillsCharts();
                    } else if (tabName === 'salary') {
                        updateSalaryCharts();
                    } else if (tabName === 'career') {
                        updateCareerPaths();
                    }
                } catch (error) {
                    console.error('Error updating charts for tab:', tabName, error);
                }
            }, 300);
        }

        // Event listeners for filters
        document.getElementById('jobTitle').addEventListener('change', filterData);
        document.getElementById('category').addEventListener('change', filterData);
        document.getElementById('location').addEventListener('change', filterData);
        document.getElementById('experience').addEventListener('change', filterData);

        // Event listener for job role filter - removed since Role Insights section was removed
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                const jobRoleFilter = document.getElementById('jobRole');
                if (jobRoleFilter) {
                    jobRoleFilter.addEventListener('change', filterData);
                }
            }, 1000);
        });

        // Initialize dashboard - with delay to ensure libraries are loaded
        window.addEventListener('load', function() {
            console.log('Page loaded, checking dependencies...');
            
            // Check if all required libraries are loaded
            const checkDependencies = () => {
                if (typeof Papa !== 'undefined' && typeof Chart !== 'undefined') {
                    console.log('All dependencies loaded, initializing dashboard...');
                    loadData();
                } else {
                    console.log('Waiting for dependencies... Papa:', typeof Papa, 'Chart:', typeof Chart);
                    setTimeout(checkDependencies, 100);
                }
            };
            
            checkDependencies();
        });
    </script>
</body>
</html>
